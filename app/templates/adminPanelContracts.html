{% extends 'layout.html' %} {% set admin_check = True %}
{% block head %}
<title>{{ translations.get('adminPanelContracts', {}).get('title', 'Admin Panel - Contracts') }}</title>
{% endblock head %}
{% block body %}
<div class="w-fit mx-auto mt-32 text-center text-2xl font-medium">
    <h1 class="my-4">
        {{ translations.get('adminPanelContracts', {}).get('title', 'Admin Panel - Contracts') }}
    </h1>
    {% for name, data in contracts.items() %}
    <details class="my-4 border rounded-md p-2">
        <summary class="font-medium cursor-pointer">{{ name }}</summary>
        <p class="mt-2">Address: {{ data['address'] }}</p>
        <form method="post" class="flex items-center justify-center mt-2">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
            <input type="hidden" name="contractName" value="{{ name }}" />
            <input
                type="text"
                name="contractAddress"
                value="{{ data['address'] }}"
                class="input input-bordered mr-2"
            />
            <button
                type="submit"
                name="contractUpdateButton"
                class="hover:text-rose-500 duration-150 font-medium"
            >
                <i class="ti ti-device-floppy mr-1 text-2xl"></i>
            </button>
        </form>
        <div id="metrics-{{ name }}" class="mt-2 text-sm"></div>
        <div class="mt-4 space-y-4">
            {% for fn in data['abi'] if fn.type == 'function' %}
            <details>
                <summary class="cursor-pointer font-medium">{{ fn.name }}</summary>
                <form
                    class="contract-form flex flex-col items-center mt-2"
                    data-contract="{{ name }}"
                    data-method="{{ fn.name }}"
                    data-action="{{ 'call' if fn.stateMutability in ['view', 'pure'] else 'transact' }}"
                >
                    {% for input in fn.inputs %}
                    <input
                        type="text"
                        name="arg{{ loop.index0 }}"
                        placeholder="{{ input.name or ('arg' ~ loop.index0) }} ({{ input.type }})"
                        class="input input-bordered mb-2"
                    />
                    {% endfor %}
                    {% if fn.stateMutability not in ['view', 'pure'] %}
                    <textarea
                        name="txOptions"
                        placeholder='{"from": "0x..."}'
                        class="textarea textarea-bordered mb-2"
                        rows="2"
                    ></textarea>
                    {% endif %}
                    <button type="submit" class="btn btn-sm btn-neutral">
                        {{ 'Call' if fn.stateMutability in ['view', 'pure'] else 'Send' }}
                    </button>
                </form>
                <div class="result mt-2 text-sm break-words"></div>
            </details>
            {% endfor %}
        </div>
    </details>
    {% endfor %}
</div>
<a href="/admin" class="hidden md:block fixed bottom-0 left-1">
    <i class="ti ti-arrow-back mr-1 text-xl hover:text-rose-500 duration-150"></i>
</a>
<script src="{{ url_for('static', filename='js/adminContracts.js') }}"></script>
{% endblock body %}

